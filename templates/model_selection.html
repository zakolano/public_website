<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Selection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</head>
<style>
    .info-icon {
    position: fixed;
    bottom: 15px;
    right: 15px;
    background-color: #007bff;
    color: white;
    border-radius: 50%;
    width: 30px; /* Reduced size */
    height: 30px; /* Reduced size */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 13px; /* Reduced size */
    z-index: 1050;
    /* Ensure it is above other elements */
    
}
.info-icon-small {
    background-color: #007bff;
    color: white;
    border-radius: 50%;
    width: 13px; /* Reduced size */
    height: 13px; /* Reduced size */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 12px; /* Reduced size */
    z-index: 1050;
    margin-right: 8px;
    margin-bottom: 4px;
    /* Ensure it is above other elements */
}
.form-label {
    margin-bottom: 4px;
}
.label-container {
        display: flex;
        align-items: center;
    }
</style>
<body>
    <div class="info-icon" data-bs-placement="right" title="Click Me!" onclick="showWelcomeInfoModal()">
        ?
    </div>
    {% include 'navbar.html' %}
    <div class="container my-4">
        <h2 class="text-center">Model Selection</h2>
        <form method="post" action="/process_model" onsubmit="return validateForm()">
            <div class="mb-4">
                <div class="label-container">
                    <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Click Me!" onclick="showpredictionMethodInfoModal() ">?</div>
                    <label for="prediction_method" class="form-label" data-bs-toggle="tooltip" data-bs-placement="right" title="Select the method you want to use for prediction.">
                        Select Prediction Method:
                    </label>
                </div>
                <select name="prediction_method" id="prediction_method" class="form-select" onchange="updateHyperparameters(document.getElementById('model_type').value, this.value)" required>
                                <option value="">Select a method</option>
                    <option value="score" {% if selected_method=='score' %}selected{% endif %}>Score</option>
                    <option value="winner" {% if selected_method=='winner' %}selected{% endif %}>Winner</option>
                </select>
            </div>
            <div class="mb-4">
                <div class="label-container">
                    <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Click Me!" onclick="showModelInfoModal()">?</div>
                    <label for="model_type" class="form-label">Select Model:</label>
                </div>
                <select name="model_type" id="model_type" class="form-select" onchange="updateHyperparameters(this.value, document.getElementById('prediction_method').value)" required>
                    <option value="">Select a model</option>
                    <option value="neural_network" {% if selected_model=='neural_network' %}selected{% endif %}>Neural Network</option>
                    <option value="decision_tree" {% if selected_model=='decision_tree' %}selected{% endif %}>Decision Tree</option>
                    <option value="linear_regression" {% if selected_model=='linear_regression' %}selected{% endif %}>Linear Regression</option>
                    <option value="k_nearest" {% if selected_model=='k_nearest' %}selected{% endif %}>Nearest Neighbors</option>
                    <option value="xg_boost" {% if selected_model=='xg_boost' %}selected{% endif %}>XG Boost</option>
                    <option value="random_forest" {% if selected_model=='random_forest' %}selected{% endif %}>Random Forest</option>
                    <!-- Add more models as needed -->
                </select>
            </div>
            <div id="hyperparameters" class="mb-4">
                <!-- Dynamic hyperparameter fields will be inserted here -->
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="ModelModal" tabindex="-1" aria-labelledby="ModelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content custom-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModelModalLabel">Model Information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Neural Network:</strong> Creates a Convolutional Neural Network to predict outcomes.</p>
                    <p><strong>Decision Tree:</strong> Works by splitting data over specific parameters i.e. all teams that shoot better than 40% go one way, the rest go the other way, repeating this process until fitted.</p>
                    <p><strong>Linear Regression:</strong> Implements Linear Regression for regression and RidgeClassificationCV for Classification, mapping each parameter to a coefficient linearly.</p>
                    <p><strong>K Nearest:</strong> Maps each point in n-dimensional space and returns the average/mode of the k-nearest other vectors.</p>
                    <p><strong>XG Boosted Tree:</strong> Essentially a fancy Decision Tree which performs better by running gradients on successive trees.</p>
                    <p><strong>Random Forest:</strong> A collection of decision trees, takes longer to train but is more accurate. (Also gives probability values)</p>
                    <p><strong>Pros and Cons:</strong> XG Boosted and Linear Regression give good results for minimal training time, while Random Forest can give better results (2-3% better) for longer training times</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="predictionMethodInfoModal" tabindex="-1" aria-labelledby="predictionMethodInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content custom-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="predictionMethodInfoModalLabel">Prediction Method Information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Score:</strong> This method does regression to predict scores of both teams.</p>
                    <p><strong>Winner:</strong> This method uses binary classification to predict the winner.</p>
                    <p><strong>Pros and Cons:</strong> The Winner method performs on average 6% better (73.5% to 66.7%) compared to Score </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content custom-modal">
                <div class="modal-header text-center">
                    <h5 class="modal-title w-100 fw-bold">Welcome</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-center fs-5">Welcome to the Parameter Selection!</p>
                    <p>You'll be selecting options for the <strong>Prediction Method</strong>, <strong>Model Type</strong>, and <strong>Parameters</strong>.</p>
                    
                    <ul>
                        <li><strong>Prediction Method</strong>: Choose between predicting <em>each team's score</em> or simply <em>which team wins</em>.</li>
                        <li><strong>Model Type</strong>: Select the type of model used for predictions.</li>
                        <li><strong>Parameters</strong>: Configure parameters specific to the selected model.</li>
                        <li><strong>Number of Models</strong>: Train multiple models and pick the best one.</li>
                    </ul>
    
                    <p class="mt-3">If unsure, using <strong>linear regression</strong> to predict the winner is a solid choice!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("show_modal2:", {{ show_modal2 | tojson }});  // Log the value to the console
            if({{ show_modal2 | tojson }}){
                var welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
                welcomeModal.show();
            }
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        });
        function showpredictionMethodInfoModal() {
            var welcomeModal = new bootstrap.Modal(document.getElementById('predictionMethodInfoModal'));
            welcomeModal.show();
        }
        function showWelcomeInfoModal() {
            var welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
            welcomeModal.show();
        }
        function showModelInfoModal() {
            var welcomeModal = new bootstrap.Modal(document.getElementById('ModelModal'));
            welcomeModal.show();
        }
        function updateHyperparameters(model, pred) {
            const hyperparametersDiv = document.getElementById('hyperparameters');
            hyperparametersDiv.innerHTML = ''; // Clear existing fields

            if (model === 'neural_network') {
                hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                    <div class = "label-container">
                        <div class ="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How fast the model converges to optima. Optimal: .01">?</div>
                        <label for="learning_rate" class="form-label">Learning Rate:</label>
                    </div>
                    <input type="number" step="0.00001" name="learning_rate" id="learning_rate" class="form-control" value="{{ hyperparameters.learning_rate | default(0.00001) }}" min="0.00001" required>
                </div>
                <div class="mb-3">
                    <div class = "label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many loss iterations to perform. Optimal: As long as you want to wait">?</div>    
                        <label for="epochs" class="form-label">Epochs:</label>
                    </div>
                    <input type="number" step = 1 name="epochs" id="epochs" class="form-control" value="{{ hyperparameters.epochs | default(100) }}" min = "10" max = "2000" required>
                </div>
            `;
            } else if (model === 'decision_tree') {
                if (pred == 'score') {
                    hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 6">?</div>    
                            <label for="max_depth" class="form-label">Max Depth:</label>
                        </div>   
                        <input type="number" name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(5) }}" required>
                </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The minimum number of samples required to split an internal node. Optimal: 2">?</div>
                            <label for="min_samples_split" class="form-label">Min Samples Split:</label>
                        </div>
                        <input type="number" name="min_samples_split" id="min_samples_split" class="form-control" value="{{ hyperparameters.min_samples_split | default(2) }}" required>
                    </div>
                <div class="mb-3">
                    <div class="label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Friedman MSE">?</div>
                        <label for="criterion" class="form-label">Criterion:</label>
                    </div>
                    <select name="criterion" id="criterion" class="form-select" required>
                        <option value="squared_error" {% if hyperparameters.criterion | default('friedman_mse') == 'squared_error' %}selected{% endif %}>Squared Error</option>
                        <option value="absolute_error" {% if hyperparameters.criterion | default('friedman_mse') == 'absolute_error' %}selected{% endif %}>Absolute Error</option>
                        <option value="friedman_mse" {% if hyperparameters.criterion | default('friedman_mse') == 'friedman_mse' %}selected{% endif %}>Friedman MSE</option>
                        <option value="poisson" {% if hyperparameters.criterion | default('friedman_mse') == 'poisson' %}selected{% endif %}>Poisson Deviance</option>
                    </select>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                </div>
            `;
                }
                else {
                    hyperparametersDiv.innerHTML = `
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 6">?</div>    
                            <label for="max_depth" class="form-label">Max Depth:</label>
                        </div>
                        <input type="number" name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(5) }}" required>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The minimum number of samples required to split an internal node. Optimal: 2">?</div>
                            <label for="min_samples_split" class="form-label">Min Samples Split:</label>
                        </div>
                        <input type="number" name="min_samples_split" id="min_samples_split" class="form-control" value="{{ hyperparameters.min_samples_split | default(2) }}" required>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Entropy Loss">?</div>    
                            <label for="criterion" class="form-label">Criterion:</label>
                        </div>
                        <select name="criterion" id="criterion" class="form-select" required>
                            <option value="gini" {% if hyperparameters.criterion | default('log_loss') == 'gini' %}selected{% endif %}>Gini</option>
                            <option value="log_loss" {% if hyperparameters.criterion | default('log_loss') == 'log_loss' %}selected{% endif %}>Log Loss</option>
                            <option value="entropy" {% if hyperparameters.criterion | default('log_loss') == 'entropy' %}selected{% endif %}>Entropy Loss</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                    </div>
                `;
                }
            } else if (model === 'linear_regression') {
                hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                    <div class="label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Whether or not to create an intercept. Optimal: True">?</div>
                        <label for="fit_intercept" class="form-label">Fit Intercept:</label>
                    </div>
                    <select name="fit_intercept" id="fit_intercept" class="form-select" required>
                        <option value="true" {% if hyperparameters.fit_intercept == 'true' %}selected{% endif %}>True</option>
                        <option value="false" {% if hyperparameters.fit_intercept == 'false' %}selected{% endif %}>False</option>
                    </select>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "100" required>
                </div>
            `;
            }
            else if (model === 'k_nearest') {
                hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                    <div class="label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of neighbors to use. Optimal: 3">?</div>
                        <label for="n_neighbors" class="form-label">Value of K:</label>
                    </div>
                    <input type="number" step = 1 name="n_neighbors" id="n_neighbors" class="form-control" value="{{ hyperparameters.n_neighbors | default(3) }}" required>
                </div>
                <div class="mb-3">
                    <div class="label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How to weight the neighbors. Optimal: Uniform">?</div>
                        <label for="k_weights" class="form-label">Weight Metric:</label>
                    </div>
                    <select name="k_weights" id="k_weights" class="form-select" required>
                        <option value="uniform" {% if hyperparameters.k_weights == 'uniform' %}selected{% endif %}>Uniform</option>
                        <option value="distance" {% if hyperparameters.k_weights == 'distance' %}selected{% endif %}>Distance</option>
                    </select>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                </div>
            `;
            }
            else if (model === 'xg_boost') {
                if(pred == 'score') {
                    console.log("score");
                    hyperparametersDiv.innerHTML = `
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class ="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How fast the model converges to optima. Optimal: .01">?</div>
                            <label for="learning_rate" class="form-label">Learning Rate:</label>
                        </div>
                        <input type="number" step = .000001 name="learning_rate" id="learning_rate" class="form-control" value="{{ hyperparameters.learning_rate | default(0.001) }}" min="0.00000" max = "1" required>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many Decision Trees to create. Optimal: 250">?</div>    
                            <label for="n_estimators" class="form-label">Num Estimators:</label>
                        </div>
                        <input type="number" step = 1 name="n_estimators" id="n_estimators" class="form-control" value="{{ hyperparameters.num_estimators | default(100) }}" min = "50" max = "500" required>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The fraction of samples to be used for fitting the individual base learners. Optimal: .8">?</div>    
                            <label for="subsample" class="form-label">Subsample:</label>
                        </div>
                        <input type="number" step = .0001 name="subsample" id="subsample" class="form-control" value="{{ hyperparameters.subsample | default(0.8) }}" min="0.1" max = "1" required>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Friedman MSE">?</div>    
                            <label for="criterion" class="form-label">Criterion:</label>
                        </div>
                            <select name="criterion" id="criterion" class="form-select" required>
                            <option selected = "selected" value="squared_error" {% if hyperparameters.criterion == 'squared_error' %}selected{% endif %}>Squared Error</option>
                            <option value="friedman_mse" {% if hyperparameters.criterion == 'friedman_mse' %}selected{% endif %}>Friedman MSE</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The minimum number of samples required to split an internal node. Optimal: 2">?</div>
                            <label for="min_samples_split" class="form-label">Min Samples Split:</label>
                        </div>
                        <input type="number" step = 1 name="min_samples_split" id="min_samples_split" class="form-control" value="{{ hyperparameters.min_samples_split | default(2) }}" required>
                    </div>
                    <div class="mb-3">
                            <div class="label-container">
                                <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 6">?</div>    
                                <label for="max_depth" class="form-label">Max Depth:</label>
                            </div>
                            <input type="number" step = 1 name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(7) }}" min = "2" max = "20" required>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How gradients are calculated (More complicated math than I can explain). Optimal: Squared Error">?</div>    
                            <label for="criterion" class="form-label">Loss Function:</label>
                        </div>
                        <select name="loss_function" id="loss_function" class="form-select" required>
                            <option value="squared_error" {% if hyperparameters.loss_function == 'squared_error' %}selected{% endif %}>Squared Error</option>
                            <option value="absolute_error" {% if hyperparameters.loss_function == 'absolute_error' %}selected{% endif %}>Absolute Error</option>
                            <option value="huber" {% if hyperparameters.loss_function == 'huber' %}selected{% endif %}>Huber</option>
                        </select>
                    </div>
                    <div class="mb-3">
                            <div class="label-container">
                                <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                                <label for="num_models" class="form-label">Number of Models:</label>
                            </div>    
                            <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                    </div>
                `;
                }
                else {
                    console.log("winner");
                    hyperparametersDiv.innerHTML = `
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class ="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How fast the model converges to optima. Optimal: .01">?</div>
                            <label for="learning_rate" class="form-label">Learning Rate:</label>
                        </div>
                        <input type="number" step = .000001 name="learning_rate" id="learning_rate" class="form-control" value="{{ hyperparameters.learning_rate | default(0.001) }}" min="0.00000" max = "1" required>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many Decision Trees to create. Optimal: 250">?</div>    
                            <label for="n_estimators" class="form-label">Num Estimators:</label>
                        </div>
                        <input type="number" step = 1 name="n_estimators" id="n_estimators" class="form-control" value="{{ hyperparameters.num_estimators | default(100) }}" min = "10" max = "500" required>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The fraction of samples to be used for fitting the individual base learners. Optimal: .8">?</div>    
                            <label for="subsample" class="form-label">Subsample:</label>
                        </div>
                        <input type="number" step = .0001 name="subsample" id="subsample" class="form-control" value="{{ hyperparameters.subsample | default(0.8) }}" min="0.1" max = "1" required>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Friedman MSE">?</div>    
                            <label for="criterion" class="form-label">Criterion:</label>
                        </div>
                        <select name="criterion" id="criterion" class="form-select" required>
                            <option selected = "selected" value="squared_error" {% if hyperparameters.criterion == 'squared_error' %}selected{% endif %}>Squared Error</option>
                            <option value="friedman_mse" {% if hyperparameters.criterion == 'friedman_mse' %}selected{% endif %}>Friedman MSE</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class = "label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The minimum number of samples required to split an internal node. Optimal: 2">?</div>
                            <label for="min_samples_split" class="form-label">Min Samples Split:</label>
                        </div>
                        <input type="number" step = 1 name="min_samples_split" id="min_samples_split" class="form-control" value="{{ hyperparameters.min_samples_split | default(2) }}" required>
                    </div>
                    <div class="mb-3">
                            <div class="label-container">
                                <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 6">?</div>    
                                <label for="max_depth" class="form-label">Max Depth:</label>
                            </div>
                            <input type="number" step = 1 name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(7) }}" min = "2" max = "20" required>
                    </div>
                    <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How gradients are calculated (More complicated math than I can explain). Optimal: Log Loss">?</div>    
                            <label for="criterion" class="form-label">Loss Function:</label>
                        </div>
                        <select name="loss_function" id="loss_function" class="form-select" required>
                            <option value="log_loss" {% if hyperparameters.loss_function == 'log_loss' %}selected{% endif %}>Log Loss</option>
                            <option value="absolute_error" {% if hyperparameters.loss_function == 'absolute_error' %}selected{% endif %}>Exponential</option>
                        </select>
                    </div>
                    <div class="mb-3">
                            <div class="label-container">
                                <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                                <label for="num_models" class="form-label">Number of Models:</label>
                            </div>    
                            <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                    </div>
                `;
                }
            }
            else if (model === 'random_forest') {

                if (pred == 'score') {
                    hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                    <div class = "label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many Decision Trees to create. Optimal: 250">?</div>    
                        <label for="n_estimators" class="form-label">Num Estimators:</label>
                    </div>
                    <input type="number" step = 1 name="n_estimators" id="n_estimators" class="form-control" value="{{ hyperparameters.n_estimators | default(100) }}" min = "50" max = "500" required>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 8">?</div>    
                            <label for="max_depth" class="form-label">Max Depth:</label>
                        </div>                   
                        <input type="number" step = 1 name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(7) }}" min = "2" max = "20" required>
                </div>
                <div class="mb-3">
                    <div class="label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Friedman MSE">?</div>    
                        <label for="criterion" class="form-label">Criterion:</label>
                    </div>
                        <select name="criterion" id="criterion" class="form-select" required>
                        <option selected = "selected" value="squared_error" {% if hyperparameters.criterion == 'squared_error' %}selected{% endif %}>Squared Error</option>
                        <option value="absolute_error" {% if hyperparameters.criterion == 'absolute_error' %}selected{% endif %}>Absolute Error</option>
                        <option value="friedman_mse" {% if hyperparameters.criterion == 'friedman_mse' %}selected{% endif %}>Friedman MSE</option>
                        <option value="poisson" {% if hyperparameters.criterion == 'poisson' %}selected{% endif %}>Poisson Deviance</option>
                    </select>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                </div>
            `;
                }
                else {
                    hyperparametersDiv.innerHTML = `
                <div class="mb-3">
                    <div class = "label-container">
                        <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many Decision Trees to create. Optimal: 250">?</div>    
                        <label for="n_estimators" class="form-label">Num Estimators:</label>
                    </div>
                    <input type="number" step = 1 name="n_estimators" id="n_estimators" class="form-control" value="{{ hyperparameters.n_estimators | default(100) }}" min = "50" max = "500" required>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="How many levels deep the tree goes. Optimal: 8">?</div>    
                            <label for="max_depth" class="form-label">Max Depth:</label>
                        </div>      
                        <input type="number" step = 1 name="max_depth" id="max_depth" class="form-control" value="{{ hyperparameters.max_depth | default(7) }}" min = "2" max = "20" required>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="The function to measure the quality of a split. (More complicated math than I can explain) Optimal: Entropy Loss">?</div>    
                            <label for="criterion" class="form-label">Criterion:</label>
                        </div>
                        <select name="criterion" id="criterion" class="form-select" required>
                            <option value="gini" {% if hyperparameters.criterion == 'gini' %}selected{% endif %}>Gini</option>
                            <option value="log_loss" {% if hyperparameters.criterion == 'log_loss' %}selected{% endif %}>Log Loss</option>
                            <option value="entropy" {% if hyperparameters.criterion == 'entropy' %}selected{% endif %}>Entropy Loss</option>
                    </select>
                </div>
                <div class="mb-3">
                        <div class="label-container">
                            <div class="info-icon-small" data-bs-toggle="tooltip" data-bs-placement="right" title="Number of models to train and use the best one">?</div>    
                            <label for="num_models" class="form-label">Number of Models:</label>
                        </div>    
                        <input type="number" step="1" name="num_models" id="num_models" class="form-control" value="{{ hyperparameters.num_models | default(1) }}" min="1" max = "10" required>
                </div>
            `;
                }
            }
        }

        function validateForm() {
            const modelType = document.getElementById('model_type').value;
            if (!modelType) {
                alert('Please select a model type.');
                return false;
            }

            const hyperparametersDiv = document.getElementById('hyperparameters');
            const inputs = hyperparametersDiv.querySelectorAll('input, select');
            for (const input of inputs) {
                if (!input.value) {
                    alert('Please fill out all hyperparameter fields.');
                    return false;
                }
            }

            return true;
        }

        // Call updateHyperparameters to pre-fill the hyperparameters when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            const selectedModel = document.getElementById('model_type').value;
            const selectedMethod = document.getElementById('prediction_method').value;
            if (selectedModel && selectedMethod) {
                updateHyperparameters(selectedModel, selectedMethod);
            }
        });

        // Initialize Bootstrap tooltips
        document.addEventListener('DOMContentLoaded', function () {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>

</html>